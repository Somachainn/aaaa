<!DOCTYPE html>
<html lang="so">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Laam Wallet</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stellar-sdk/10.4.0/stellar-sdk.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<style>
  :root{
    /* Blue & White Theme */
    --bg1:#eef2f3; --bg2:#8e9eab;
    --card:rgba(255, 255, 255, 0.9);
    --text:#0a192f; --muted:#546e7a;
    --brand:#0052cc; --brand2:#0041a3; --line:#d0d8e0;
    --ok:#28a745; --warn:#ffc107; --err:#dc3545;
    --maxw: 920px; --rad:16px;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
    color:var(--text);
    background:linear-gradient(135deg,#b8c6db,#f5f7fa);
    min-height:100vh; display:flex; align-items:center; justify-content:center; padding:24px 14px;
  }
  .app{ width:100%; max-width:450px; text-align:center; }
  
  /* Logo and Header Styles */
  .logo-container{ 
    display:flex; 
    align-items:center; 
    justify-content:center; 
    gap:15px; 
    margin-bottom:40px; 
  }
  .logo-container img{ 
    width:80px; 
    height:80px; 
    border-radius:50%;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
  }
  h1{ 
    margin:0; 
    font-size:3rem; 
    font-weight:800; 
    color:#1976d2; 
    text-shadow:1px 1px 2px rgba(0,0,0,0.1); 
  }
  
  /* Token Info Card - New enhanced display */
  .token-info-card {
    background:rgba(255, 255, 255, 0.95);
    border:none;
    border-radius:24px;
    box-shadow:0 8px 32px rgba(0,0,0,0.12);
    padding:30px;
    margin:20px auto;
    backdrop-filter:blur(10px);
    max-width:100%;
  }
  
  .token-header {
    display:flex;
    align-items:center;
    gap:15px;
    margin-bottom:25px;
    padding-bottom:20px;
    border-bottom:2px solid #e0e0e0;
  }
  
  .token-header img {
    width:60px;
    height:60px;
    border-radius:50%;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
  }
  
  .token-details h2 {
    margin:0;
    font-size:1.8rem;
    font-weight:700;
    color:#1976d2;
  }
  
  .token-code {
    font-size:0.9rem;
    color:#666;
    font-family:'SF Mono', Monaco, monospace;
    background:#f0f0f0;
    padding:4px 8px;
    border-radius:6px;
    margin-top:5px;
  }
  
  .balance-section {
    margin-bottom:25px;
  }
  
  .balance-title {
    font-size:1.1rem;
    font-weight:600;
    color:#1976d2;
    margin-bottom:15px;
    text-align:left;
  }
  
  .balance-display {
    background:#f8f9fa;
    border:2px solid #e0e0e0;
    border-radius:16px;
    padding:20px;
    text-align:center;
  }
  
  .balance-amount {
    font-size:2.2rem;
    font-weight:800;
    color:#1976d2;
    margin-bottom:8px;
  }
  
  .balance-usd {
    font-size:1.1rem;
    color:#666;
    margin-bottom:5px;
  }
  
  .balance-price {
    font-size:0.9rem;
    color:#999;
  }
  
  .price-section {
    margin-bottom:25px;
  }
  
  .price-grid {
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:15px;
  }
  
  .price-item {
    background:#f8f9fa;
    border:2px solid #e0e0e0;
    border-radius:12px;
    padding:15px;
    text-align:center;
  }
  
  .price-label {
    font-size:0.9rem;
    color:#666;
    margin-bottom:8px;
  }
  
  .price-value {
    font-size:1.4rem;
    font-weight:700;
    color:#1976d2;
  }
  
  .token-description {
    background:#e3f2fd;
    border-left:4px solid #1976d2;
    padding:15px;
    border-radius:8px;
    text-align:left;
    font-size:0.95rem;
    line-height:1.5;
    color:#333;
    margin-bottom:25px;
  }
  
  .issuer-info {
    background:#f5f5f5;
    border-radius:12px;
    padding:15px;
    margin-bottom:20px;
  }
  
  .issuer-label {
    font-size:0.9rem;
    color:#666;
    margin-bottom:8px;
  }
  
  .issuer-address {
    font-family:'SF Mono', Monaco, monospace;
    font-size:0.8rem;
    color:#333;
    background:#fff;
    padding:8px;
    border-radius:6px;
    word-break:break-all;
    border:1px solid #ddd;
  }
  
  /* Import Card Styles */
  .import-card{
    background:rgba(255, 255, 255, 0.95);
    border:none;
    border-radius:24px;
    box-shadow:0 8px 32px rgba(0,0,0,0.12);
    padding:40px 30px;
    margin:0 auto;
    backdrop-filter:blur(10px);
    max-width:100%;
  }
  
  .form-group{
    margin-bottom:24px;
    text-align:left;
  }
  
  .form-label{
    display:block;
    font-size:18px;
    font-weight:700;
    color:#1976d2;
    margin-bottom:12px;
  }
  
  .form-input{
    width:100%;
    padding:20px;
    border:2px solid #e0e0e0;
    border-radius:16px;
    font-size:16px;
    background:#f8f9fa;
    color:#333;
    outline:none;
    transition:all 0.3s ease;
    font-family:'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
  }
  
  .form-input:focus{
    border-color:#1976d2;
    background:white;
    box-shadow:0 0 0 4px rgba(25,118,210,0.1);
  }
  
  .form-input::placeholder{
    color:#bbb;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  }
  
  .import-button{
    width:100%;
    padding:20px;
    background:#1976d2;
    color:white;
    border:none;
    border-radius:16px;
    font-size:18px;
    font-weight:700;
    text-transform:uppercase;
    letter-spacing:1px;
    cursor:pointer;
    transition:all 0.3s ease;
    box-shadow:0 4px 16px rgba(25,118,210,0.3);
    margin-top:16px;
  }
  
  .import-button:hover{
    background:#1565c0;
    box-shadow:0 6px 20px rgba(25,118,210,0.4);
    transform:translateY(-2px);
  }
  
  .divider{
    margin:32px 0;
    text-align:center;
    position:relative;
  }
  
  .divider::before{
    content:'';
    position:absolute;
    top:50%;
    left:0;
    right:0;
    height:1px;
    background:#e0e0e0;
  }
  
  .divider-text{
    background:rgba(255, 255, 255, 0.95);
    padding:0 16px;
    color:#666;
    font-size:14px;
    font-weight:500;
  }
  
  .generate-link{
    text-align:center;
  }
  
  .generate-button{
    color:#1976d2;
    text-decoration:underline;
    background:none;
    border:none;
    cursor:pointer;
    font-size:16px;
    font-weight:600;
    transition:color 0.3s ease;
    text-transform:none;
    padding:0;
    width:auto;
    box-shadow:none;
  }
  
  .generate-button:hover{
    color:#1565c0;
    transform:none;
    box-shadow:none;
  }
  
  .note-text{
    font-size:12px;
    color:#666;
    margin-top:8px;
    line-height:1.4;
  }

  /* Original styles for other sections */
  .card{
    background:var(--card); border:1px solid var(--line); border-radius:var(--rad);
    box-shadow:0 10px 30px rgba(0,0,0,0.1); padding:22px; margin:14px auto;
  }
  .grid-2{ display:grid; grid-template-columns:1fr 1fr; gap:16px; }
  @media (max-width:820px){ .grid-2{ grid-template-columns:1fr; } }
  label{ display:block; text-align:left; margin:8px 0 6px; font-weight:600; color:var(--brand); }
  input,select,button{
    width:100%; padding:12px 14px; border:1px solid var(--line); border-radius:12px; font-size:1rem;
    background:#f8f9fa; color:var(--text); outline:none; transition:border-color .2s ease;
  }
  input:focus{ border-color:var(--brand); }
  button{
    background:var(--brand); color:#fff; font-weight:700; letter-spacing:.02em; border:none;
    box-shadow:0 4px 14px rgba(0,82,204,0.3); cursor:pointer; text-transform:uppercase; transition:all .2s ease;
  }
  button:hover{ background:var(--brand2); box-shadow:0 6px 18px rgba(0,65,163,0.4); transform:translateY(-2px); }
  button:disabled{ background:#b0bec5; cursor:not-allowed; box-shadow:none; transform:none; }
  .btn-secondary{ background:#6c757d; color:#fff; box-shadow:0 4px 14px rgba(0,0,0,0.1); }
  .btn-secondary:hover{ background:#5a6268; }
  .btn-danger{ background:var(--err); color:#fff; box-shadow:0 4px 14px rgba(220,53,69,0.3); }
  .btn-danger:hover{ background:#c82333; }
  .mono{
    font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;
    background:#e9ecef; padding:10px 12px; border-radius:12px; overflow-wrap:anywhere; color:#343a40;
  }
  .muted{ color:var(--muted); font-size:.92rem; }
  .balances{ display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap; }
  .pill{ background:#e9ecef; border:1px solid var(--line); padding:8px 14px; border-radius:999px; font-weight:600; }
  .hidden{ display:none; }
  .send-wrap{ display:none; margin-top:16px; text-align:left; border-top:1px solid var(--line); padding-top:16px; }
  .send-row{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
  @media (max-width:640px){ .send-row{ grid-template-columns:1fr; } }

  /* Animation */
  .import-card, .token-info-card {
    animation: slideUp 0.6s ease-out;
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @media (max-width: 480px) {
    .app {
      max-width: 100%;
      padding: 0 10px;
    }
    
    .import-card, .token-info-card {
      padding: 30px 20px;
      margin: 10px;
    }
    
    .logo-container img {
      width: 60px;
      height: 60px;
    }
    
    h1 {
      font-size: 2.2rem;
    }
    
    .price-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>
<body>
  <div class="app">
    <div class="logo-container">
      <img src="https://i.ibb.co/r28SP1bN/20250802-225108.png" alt="Laam Logo">
      <h1>Laam Wallet</h1>
    </div>

    <!-- TOKEN INFO SECTION - New enhanced display -->
    <div class="token-info-card">
      <div class="token-header">
        <img src="https://i.ibb.co/r28SP1bN/20250802-225108.png" alt="Laam Token">
        <div class="token-details">
          <h2>Laam Token</h2>
          <div class="token-code">LAAM</div>
        </div>
      </div>
      
      <div class="balance-section">
        <div class="balance-title">Available Balance</div>
        <div class="balance-display">
          <div class="balance-amount" id="laamBalance">0.00</div>
          <div class="balance-usd">â‰ˆ $<span id="laamBalanceUsd">0.00</span> USD</div>
          <div class="balance-price">@ $<span id="currentLaamPrice">0.06</span> per LAAM</div>
        </div>
      </div>
      
      <div class="price-section">
        <div class="balance-title">Price Information</div>
        <div class="price-grid">
          <div class="price-item">
            <div class="price-label">Current Price</div>
            <div class="price-value">$0.06</div>
          </div>
          <div class="price-item">
            <div class="price-label">Max Supply</div>
            <div class="price-value">1.34M</div>
          </div>
        </div>
      </div>
      
      <div class="token-description">
        <strong>About Laam:</strong> Laam is a limited supply token on Stellar with a maximum of 1,335,577 tokens, issued only once to preserve value.
      </div>
      
      <div class="issuer-info">
        <div class="issuer-label">Token Issuer Address:</div>
        <div class="issuer-address">GAL4ECDAXNBMJYFCWIJ32HKVIRLCNEXY664CAZYI3EINQWPLXTMEPR64</div>
      </div>
    </div>

    <!-- AUTH SECTION -->
    <div id="authSection">
      <div class="import-card">
        <div id="unlockView" class="hidden">
          <h3 style="margin:0 0 20px 0; color:#1976d2; text-align:center; font-size:1.5rem;">Unlock Wallet</h3>
          <div class="form-group">
            <label class="form-label" for="walletPassword">Password</label>
            <input class="form-input" id="walletPassword" type="password" placeholder="Enter your password" />
          </div>
          <button class="import-button" id="unlockBtn">Unlock</button>
          <div class="divider">
            <span class="divider-text">or</span>
          </div>
          <div class="generate-link">
            <a href="#" id="resetWalletLink" style="color:#1976d2; text-decoration:none;">Reset and Import New Key</a>
          </div>
        </div>

        <div id="initialView">
          <div class="form-group">
            <label class="form-label" for="secretKeyInput">Secret Key (S...)</label>
            <input class="form-input" id="secretKeyInput" type="password" placeholder="SXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"/>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="savePasswordInput">Create Password to Save</label>
            <input class="form-input" id="savePasswordInput" type="password" placeholder="Min 8 chars"/>
          </div>
          
          <button class="import-button" id="importAndSaveBtn">Import and Save</button>
          
          <div class="divider">
            <span class="divider-text">Ama</span>
          </div>
          
          <div class="generate-link">
            <button class="generate-button" id="generateAccountBtn">Generate new Stellar account</button>
            <p class="note-text">(xasuuso: waa in aad ku shubtaa ugu yaraan 2 XLM si loo furo)</p>
          </div>
        </div>
      </div>
    </div>

    <!-- LOGGED IN VIEW -->
    <div id="loggedInView" class="hidden">
      <div class="card">
        <div class="balances">
          <div class="pill">
            <div>XLM: <span id="xlmBal">0.00</span></div>
            <div class="muted" style="font-size:0.8rem;">$<span id="xlmUsd">0.00</span> ($<span id="xlmPrice">0.00</span>/XLM)</div>
          </div>
          <div class="pill">
            <div>Laam: <span id="laamBal">0.00</span></div>
            <div class="muted" style="font-size:0.8rem;">$<span id="laamUsd">0.00</span> ($<span id="laamPrice">0.06</span>/Laam)</div>
          </div>
        </div>
        <label style="margin-top:10px;">Your Public Key</label>
        <div id="pubKey" class="mono">-</div>
        <div style="display:flex; gap:10px; margin-top:16px; justify-content:center;">
          <button id="btnSendToggle">Send</button>
          <button id="addTrustlineBtn">Add Laam Trustline</button>
          <button id="logoutBtn" class="btn-danger">Lock Wallet</button>
        </div>

        <div id="sendForm" class="send-wrap">
          <h4 style="margin:0 0 10px 0; color:var(--brand)">Send Assets</h4>
          <div class="send-row">
            <div><label for="sendAsset">Asset</label><select id="sendAsset"><option value="XLM">XLM</option><option value="LAAM">Laam</option></select></div>
            <div><label for="sendAmount">Amount</label><input id="sendAmount" type="number" step="0.0000001" placeholder="e.g. 10" /></div>
          </div>
          <label for="sendDest" style="margin-top:8px;">Destination Public Key</label>
          <input id="sendDest" type="text" placeholder="G... destination" />
          <button id="btnSend" style="margin-top:10px;">Send Now</button>
        </div>
      </div>
    </div>
  </div>

<script>
// Token information
const LAAM_TOKEN = {
  code: "Laam",
  issuer: "GAL4ECDAXNBMJYFCWIJ32HKVIRLCNEXY664CAZYI3EINQWPLXTMEPR64",
  name: "Laam",
  description: "Laam is a limited supply token on Stellar with a maximum of 1,335,577 tokens, issued only once to preserve value.",
  image: "https://i.ibb.co/r28SP1bN/20250802-225108.png",
  maxSupply: 1335577,
  currentPrice: 0.06
};

// Initialize Stellar SDK
const StellarSdk = window.StellarSdk;
const server = new StellarSdk.Server('https://horizon.stellar.org');

let currentKeypair = null;
let currentAccount = null;

// DOM elements
const authSection = document.getElementById('authSection');
const loggedInView = document.getElementById('loggedInView');
const initialView = document.getElementById('initialView');
const unlockView = document.getElementById('unlockView');

// Update balance display
async function updateBalanceDisplay() {
  if (!currentAccount) return;
  
  try {
    const account = await server.loadAccount(currentKeypair.publicKey());
    let laamBalance = 0;
    
    // Find Laam balance
    account.balances.forEach(balance => {
      if (balance.asset_code === 'Laam' && balance.asset_issuer === LAAM_TOKEN.issuer) {
        laamBalance = parseFloat(balance.balance);
      }
    });
    
    // Update the token info card
    document.getElementById('laamBalance').textContent = laamBalance.toFixed(2);
    document.getElementById('laamBalanceUsd').textContent = (laamBalance * LAAM_TOKEN.currentPrice).toFixed(2);
    document.getElementById('currentLaamPrice').textContent = LAAM_TOKEN.currentPrice.toFixed(2);
    
    // Update the logged in view balances
    document.getElementById('laamBal').textContent = laamBalance.toFixed(2);
    document.getElementById('laamUsd').textContent = (laamBalance * LAAM_TOKEN.currentPrice).toFixed(2);
    document.getElementById('laamPrice').textContent = LAAM_TOKEN.currentPrice.toFixed(2);
    
  } catch (error) {
    console.error('Error updating balance:', error);
  }
}

// Check if wallet is saved
function checkSavedWallet() {
  const encryptedKey = localStorage.getItem('laam_wallet_key');
  if (encryptedKey) {
    initialView.classList.add('hidden');
    unlockView.classList.remove('hidden');
  }
}

// Import and save wallet
document.getElementById('importAndSaveBtn').addEventListener('click', async () => {
  const secretKey = document.getElementById('secretKeyInput').value.trim();
  const password = document.getElementById('savePasswordInput').value;
  
  if (!secretKey || !password) {
    alert('Please fill in both fields');
    return;
  }
  
  if (password.length < 8) {
    alert('Password must be at least 8 characters');
    return;
  }
  
  try {
    const keypair = StellarSdk.Keypair.fromSecret(secretKey);
    
    // Encrypt and save
    const encrypted = CryptoJS.AES.encrypt(secretKey, password).toString();
    localStorage.setItem('laam_wallet_key', encrypted);
    
    currentKeypair = keypair;
    showLoggedInView();
    
  } catch (error) {
    alert('Invalid secret key');
  }
});

// Unlock wallet
document.getElementById('unlockBtn').addEventListener('click', () => {
  const password = document.getElementById('walletPassword').value;
  const encryptedKey = localStorage.getItem('laam_wallet_key');
  
  try {
    const decrypted = CryptoJS.AES.decrypt(encryptedKey, password).toString(CryptoJS.enc.Utf8);
    const keypair = StellarSdk.Keypair.fromSecret(decrypted);
    
    currentKeypair = keypair;
    showLoggedInView();
    
  } catch (error) {
    alert('Incorrect password');
  }
});

// Show logged in view
async function showLoggedInView() {
  authSection.classList.add('hidden');
  loggedInView.classList.remove('hidden');
  
  document.getElementById('pubKey').textContent = currentKeypair.publicKey();
  
  try {
    currentAccount = await server.loadAccount(currentKeypair.publicKey());
    await updateBalanceDisplay();
  } catch (error) {
    console.error('Error loading account:', error);
  }
}

// Generate new account
document.getElementById('generateAccountBtn').addEventListener('click', () => {
  const keypair = StellarSdk.Keypair.random();
  document.getElementById('secretKeyInput').value = keypair.secret();
  alert('New account generated! Make sure to fund it with at least 2 XLM to activate.');
});

// Reset wallet
document.getElementById('resetWalletLink').addEventListener('click', (e) => {
  e.preventDefault();
  if (confirm('This will remove your saved wallet. Are you sure?')) {
    localStorage.removeItem('laam_wallet_key');
    unlockView.classList.add('hidden');
    initialView.classList.remove('hidden');
  }
});

// Logout
document.getElementById('logoutBtn').addEventListener('click', () => {
  currentKeypair = null;
  currentAccount = null;
  loggedInView.classList.add('hidden');
  authSection.classList.remove('hidden');
});

// Add trustline for Laam
document.getElementById('addTrustlineBtn').addEventListener('click', async () => {
  if (!currentKeypair) return;
  
  try {
    const account = await server.loadAccount(currentKeypair.publicKey());
    const asset = new StellarSdk.Asset(LAAM_TOKEN.code, LAAM_TOKEN.issuer);
    
    const transaction = new StellarSdk.TransactionBuilder(account, {
      fee: StellarSdk.BASE_FEE,
      networkPassphrase: StellarSdk.Networks.PUBLIC
    })
    .addOperation(StellarSdk.Operation.changeTrust({ asset }))
    .setTimeout(180)
    .build();
    
    transaction.sign(currentKeypair);
    
    const result = await server.submitTransaction(transaction);
    alert('Laam trustline added successfully!');
    await updateBalanceDisplay();
    
  } catch (error) {
    console.error('Error adding trustline:', error);
    alert('Error adding trustline: ' + error.message);
  }
});

// Send toggle
document.getElementById('btnSendToggle').addEventListener('click', () => {
  const sendForm = document.getElementById('sendForm');
  sendForm.style.display = sendForm.style.display === 'none' ? 'block' : 'none';
});

// Send transaction
document.getElementById('btnSend').addEventListener('click', async () => {
  const asset = document.getElementById('sendAsset').value;
  const amount = document.getElementById('sendAmount').value;
  const destination = document.getElementById('sendDest').value;
  
  if (!amount || !destination) {
    alert('Please fill in all fields');
    return;
  }
  
  try {
    const account = await server.loadAccount(currentKeypair.publicKey());
    
    let operation;
    if (asset === 'XLM') {
      operation = StellarSdk.Operation.payment({
        destination,
        asset: StellarSdk.Asset.native(),
        amount
      });
    } else {
      const laamAsset = new StellarSdk.Asset(LAAM_TOKEN.code, LAAM_TOKEN.issuer);
      operation = StellarSdk.Operation.payment({
        destination,
        asset: laamAsset,
        amount
      });
    }
    
    const transaction = new StellarSdk.TransactionBuilder(account, {
      fee: StellarSdk.BASE_FEE,
      networkPassphrase: StellarSdk.Networks.PUBLIC
    })
    .addOperation(operation)
    .setTimeout(180)
    .build();
    
    transaction.sign(currentKeypair);
    
    const result = await server.submitTransaction(transaction);
    alert('Transaction sent successfully!');
    await updateBalanceDisplay();
    
    // Clear form
    document.getElementById('sendAmount').value = '';
    document.getElementById('sendDest').value = '';
    document.getElementById('sendForm').style.display = 'none';
    
  } catch (error) {
    console.error('Error sending transaction:', error);
    alert('Error sending transaction: ' + error.message);
  }
});

// Initialize app
checkSavedWallet();

// Update balance every 30 seconds
setInterval(() => {
  if (currentKeypair) {
    updateBalanceDisplay();
  }
}, 30000);
</script>
</body>
</html>
